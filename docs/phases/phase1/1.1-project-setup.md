# Initiative 1.1: Project Setup

**Timeline:** Week 1
**Goal:** Establish development environment, project structure, and CI/CD pipeline

---

## Overview

This initiative establishes the foundation for the entire project. Before writing any streaming logic, we need a solid development environment, clear project structure, and automated quality checks. This week is about setting up the scaffolding that will support 18+ months of development.

---

## What We're Building

A professional Rust workspace with:
- Multi-crate structure for modularity
- Automated CI/CD for quality assurance
- Local S3 environment for development
- Clear documentation and contribution guidelines

---

## Tasks Breakdown

### Task 1: GitHub Repository Setup

**What:**
- âœ“ Create repository (already done)
- Set up branch protection rules
- Configure GitHub settings

**Branch Strategy:**
```
main          â† Production-ready code, protected
â”œâ”€â”€ develop   â† Integration branch (optional for solo)
â””â”€â”€ feature/* â† Feature branches
```

**Branch Protection Rules:**
- Require PR reviews (when team grows)
- Require status checks to pass
- Require branches to be up to date

**Commands:**
```bash
# Already done, but for reference:
git init
git remote add origin https://github.com/yourusername/streamhouse.git
git branch -M main
git push -u origin main
```

---

### Task 2: Rust Workspace Configuration

**What:**
A cargo workspace that manages multiple related crates as a single project.

**Workspace Structure:**
```
streamhouse/
â”œâ”€â”€ Cargo.toml              # Workspace root
â”œâ”€â”€ Cargo.lock              # Locked dependencies (commit this)
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ LICENSE
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ phases/             # Phase documentation
â”‚   â”œâ”€â”€ architecture/       # Architecture docs
â”‚   â””â”€â”€ api/                # API documentation
â”œâ”€â”€ crates/
â”‚   â”œâ”€â”€ streamhouse-core/          # Shared types, errors, traits
â”‚   â”œâ”€â”€ streamhouse-storage/       # S3 segment read/write
â”‚   â”œâ”€â”€ streamhouse-metadata/      # Topic/partition metadata
â”‚   â”œâ”€â”€ streamhouse-kafka/         # Kafka protocol (Phase 2)
â”‚   â”œâ”€â”€ streamhouse-sql/           # SQL parsing (Phase 3)
â”‚   â”œâ”€â”€ streamhouse-execution/     # Stream operators (Phase 3)
â”‚   â”œâ”€â”€ streamhouse-state/         # State management (Phase 3)
â”‚   â”œâ”€â”€ streamhouse-coordinator/   # Distributed coordinator (Phase 4)
â”‚   â”œâ”€â”€ streamhouse-worker/        # Worker nodes (Phase 4)
â”‚   â”œâ”€â”€ streamhouse-server/        # Main server binary
â”‚   â””â”€â”€ streamhouse-cli/           # CLI tool
â”œâ”€â”€ benches/                # Benchmarks
â”œâ”€â”€ tests/                  # Integration tests
â””â”€â”€ scripts/                # Helper scripts
```

**Root Cargo.toml:**
```toml
[workspace]
resolver = "2"
members = [
    "crates/streamhouse-core",
    "crates/streamhouse-storage",
    "crates/streamhouse-metadata",
    "crates/streamhouse-kafka",
    "crates/streamhouse-server",
    "crates/streamhouse-cli",
]

[workspace.package]
version = "0.1.0"
edition = "2021"
authors = ["Your Name <your.email@example.com>"]
license = "MIT OR Apache-2.0"
repository = "https://github.com/yourusername/streamhouse"

[workspace.dependencies]
# Async runtime
tokio = { version = "1.35", features = ["full"] }
tokio-util = { version = "0.7", features = ["codec"] }

# Data processing
arrow = "50.0"
datafusion = "35.0"
parquet = "50.0"

# Storage
object_store = { version = "0.9", features = ["aws", "http"] }
aws-sdk-s3 = "1.13"
rocksdb = "0.21"

# Networking
tonic = { version = "0.11", features = ["transport"] }
tonic-build = "0.11"
prost = "0.12"
hyper = "1.1"

# Serialization
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
bincode = "1.3"

# Compression
lz4_flex = "0.11"
zstd = "0.13"

# Utilities
bytes = "1.5"
thiserror = "1.0"
anyhow = "1.0"
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter"] }

# CLI
clap = { version = "4.4", features = ["derive"] }

# Database
sqlx = { version = "0.7", features = ["runtime-tokio", "sqlite"] }

# Checksums
crc32fast = "1.3"

# Testing
tempfile = "3.8"
criterion = "0.5"
```

**Individual Crate Setup:**
```bash
# Create each crate
cargo new --lib crates/streamhouse-core
cargo new --lib crates/streamhouse-storage
cargo new --lib crates/streamhouse-metadata
cargo new --lib crates/streamhouse-kafka
cargo new --bin crates/streamhouse-server
cargo new --bin crates/streamhouse-cli

# Verify workspace builds
cargo build --workspace
cargo test --workspace
```

---

### Task 3: CI/CD Pipeline

**What:**
Automated checks on every commit/PR to catch bugs early.

**GitHub Actions Workflow:**

`.github/workflows/ci.yml`:
```yaml
name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

env:
  RUST_BACKTRACE: 1
  CARGO_TERM_COLOR: always

jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Cache dependencies
        uses: Swatinem/rust-cache@v2

      - name: Run tests
        run: cargo test --workspace --all-features

  fmt:
    name: Format
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          components: rustfmt

      - name: Check formatting
        run: cargo fmt --all -- --check

  clippy:
    name: Clippy
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy

      - name: Cache dependencies
        uses: Swatinem/rust-cache@v2

      - name: Run clippy
        run: cargo clippy --workspace --all-features -- -D warnings

  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Cache dependencies
        uses: Swatinem/rust-cache@v2

      - name: Build
        run: cargo build --workspace --release

  bench:
    name: Benchmark
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v4

      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Cache dependencies
        uses: Swatinem/rust-cache@v2

      - name: Run benchmarks
        run: cargo bench --workspace
```

**What This Provides:**
- âœ… All tests run automatically
- âœ… Code formatting enforced (rustfmt)
- âœ… Linting enforced (clippy)
- âœ… Build verification
- âœ… Benchmarks tracked on main branch

---

### Task 4: Local Development Environment

**What:**
Set up MinIO (S3-compatible storage) for local development.

**Docker Compose Setup:**

`docker-compose.yml`:
```yaml
version: '3.8'

services:
  minio:
    image: minio/minio:latest
    container_name: streamhouse-minio
    ports:
      - "9000:9000"      # API
      - "9001:9001"      # Console
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data --console-address ":9001"
    volumes:
      - minio-data:/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3

  # Future: Add PostgreSQL for distributed metadata store
  # postgres:
  #   image: postgres:15
  #   container_name: streamhouse-postgres
  #   ports:
  #     - "5432:5432"
  #   environment:
  #     POSTGRES_USER: streamhouse
  #     POSTGRES_PASSWORD: streamhouse
  #     POSTGRES_DB: streamhouse_metadata
  #   volumes:
  #     - postgres-data:/var/lib/postgresql/data

volumes:
  minio-data:
  # postgres-data:
```

**Start Services:**
```bash
# Start MinIO
docker-compose up -d

# Verify MinIO is running
curl http://localhost:9000/minio/health/live

# Access MinIO Console
# Open browser: http://localhost:9001
# Login: minioadmin / minioadmin
```

**Create Test Bucket:**
```bash
# Install MinIO client (mc)
# macOS:
brew install minio/stable/mc

# Linux:
wget https://dl.min.io/client/mc/release/linux-amd64/mc
chmod +x mc

# Configure
mc alias set local http://localhost:9000 minioadmin minioadmin

# Create bucket
mc mb local/streamhouse-dev

# Verify
mc ls local/
```

**Helper Script:**

`scripts/dev-env.sh`:
```bash
#!/bin/bash

set -e

echo "Starting StreamHouse development environment..."

# Start Docker services
docker-compose up -d

# Wait for MinIO
echo "Waiting for MinIO..."
until curl -f http://localhost:9000/minio/health/live 2>/dev/null; do
    sleep 1
done

# Create bucket if not exists
mc alias set local http://localhost:9000 minioadmin minioadmin 2>/dev/null || true
mc mb local/streamhouse-dev 2>/dev/null || echo "Bucket already exists"

echo "âœ… Development environment ready!"
echo "   MinIO API: http://localhost:9000"
echo "   MinIO Console: http://localhost:9001"
echo "   Bucket: streamhouse-dev"
```

```bash
chmod +x scripts/dev-env.sh
./scripts/dev-env.sh
```

---

### Task 5: README Documentation

**What:**
Clear project overview for contributors and users.

`README.md`:
```markdown
# StreamHouse

**A unified S3-native streaming platform that replaces Kafka + Flink**

StreamHouse is a next-generation streaming data platform built in Rust that stores data natively in S3 (or S3-compatible storage) and provides integrated SQL stream processing. It offers the transport capabilities of Kafka and the processing power of Flink in a single, simplified system.

## Vision

- **Month 4**: Kafka replacement, 80% cheaper
- **Month 10**: Kafka + Flink in one system
- **Month 14**: Drop-in replacement with built-in SQL processing

## Status

ğŸš§ **Early Development** - Phase 1: Core Storage Layer (Weeks 1-8)

Current progress: Week 1 - Project Setup

## Quick Start

### Prerequisites

- Rust 1.75+ (`rustup install stable`)
- Docker & Docker Compose
- MinIO client (optional, for testing)

### Development

```bash
# Start local S3 (MinIO)
./scripts/dev-env.sh

# Build all crates
cargo build --workspace

# Run tests
cargo test --workspace

# Run server (when available)
cargo run --bin streamhouse-server

# Run CLI (when available)
cargo run --bin streamhouse-cli -- topic create test --partitions 3
```

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  StreamHouse                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Phase 1: Storage Layer (S3-native log)            â”‚
â”‚  Phase 2: Kafka Protocol (drop-in compatibility)   â”‚
â”‚  Phase 3: SQL Processing (streaming queries)       â”‚
â”‚  Phase 4: Distributed (multi-node fault-tolerant)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

See [docs/phases/](docs/phases/) for detailed phase documentation.

## Project Structure

```
streamhouse/
â”œâ”€â”€ crates/
â”‚   â”œâ”€â”€ streamhouse-core/       # Shared types and traits
â”‚   â”œâ”€â”€ streamhouse-storage/    # S3 segment management
â”‚   â”œâ”€â”€ streamhouse-metadata/   # Topic/partition metadata
â”‚   â”œâ”€â”€ streamhouse-kafka/      # Kafka protocol
â”‚   â”œâ”€â”€ streamhouse-server/     # Main server
â”‚   â””â”€â”€ streamhouse-cli/        # Command-line tool
â”œâ”€â”€ docs/                       # Documentation
â””â”€â”€ tests/                      # Integration tests
```

## Development

### Code Style

```bash
# Format code
cargo fmt --all

# Run linter
cargo clippy --workspace --all-features

# Run benchmarks
cargo bench --workspace
```

### Running Tests

```bash
# Unit tests
cargo test --workspace

# Integration tests
cargo test --test '*'

# Specific crate
cargo test -p streamhouse-storage
```

## Contributing

See [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines.

## Roadmap

- [x] Week 1: Project setup
- [ ] Week 2: Segment format
- [ ] Week 3: Metadata store
- [ ] Week 4: Write path
- [ ] Week 5: Read path
- [ ] Week 6: API server
- [ ] Week 7: CLI tool
- [ ] Week 8: Testing & docs

See [docs/streaming-platform-project-plan-v2.md](docs/streaming-platform-project-plan-v2.md) for full roadmap.

## License

Licensed under either of:

- Apache License, Version 2.0 ([LICENSE-APACHE](LICENSE-APACHE))
- MIT license ([LICENSE-MIT](LICENSE-MIT))

at your option.

## Acknowledgments

Built on the shoulders of giants:
- [Apache Arrow](https://arrow.apache.org/) - Columnar data format
- [DataFusion](https://arrow.apache.org/datafusion/) - SQL query engine
- [Tokio](https://tokio.rs/) - Async runtime
```

---

### Task 6: Additional Configuration Files

**`.gitignore`:**
```gitignore
# Rust
/target
**/*.rs.bk
*.pdb
Cargo.lock  # Remove this line if building a binary

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# Local development
/data
*.db
*.db-shm
*.db-wal

# Environment
.env
.env.local
```

**`rustfmt.toml`:**
```toml
edition = "2021"
max_width = 100
hard_tabs = false
tab_spaces = 4
newline_style = "Unix"
use_small_heuristics = "Default"
reorder_imports = true
reorder_modules = true
remove_nested_parens = true
```

**`clippy.toml`:**
```toml
# Warn on missing documentation for public items
missing-docs-in-private-items = false
```

**`.editorconfig`:**
```ini
root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true

[*.rs]
indent_style = space
indent_size = 4

[*.toml]
indent_style = space
indent_size = 2

[*.yml]
indent_style = space
indent_size = 2

[*.md]
trim_trailing_whitespace = false
```

---

## Testing the Setup

### Verification Checklist

```bash
# 1. Build succeeds
cargo build --workspace
# Expected: All crates compile successfully

# 2. Tests pass
cargo test --workspace
# Expected: All tests pass (even if just default tests)

# 3. Formatting is correct
cargo fmt --all -- --check
# Expected: No formatting issues

# 4. Clippy is happy
cargo clippy --workspace --all-features
# Expected: No warnings

# 5. MinIO is running
curl http://localhost:9000/minio/health/live
# Expected: HTTP 200

# 6. Bucket exists
mc ls local/streamhouse-dev
# Expected: Bucket listed (may be empty)

# 7. CI would pass
# Push to GitHub and verify Actions run successfully
```

---

## Common Issues & Solutions

### Issue: MinIO won't start
```bash
# Check if port 9000 is already in use
lsof -i :9000

# Kill conflicting process or change port in docker-compose.yml
docker-compose down
docker-compose up -d
```

### Issue: Cargo build fails
```bash
# Update Rust
rustup update stable

# Clean and rebuild
cargo clean
cargo build --workspace
```

### Issue: CI failing on GitHub
- Check that all dependencies are in `Cargo.toml`
- Verify tests pass locally first
- Check GitHub Actions logs for specific errors

---

## Deliverables

At the end of Week 1, you should have:

- [x] **Running CI pipeline**
  - Tests run automatically on push/PR
  - Formatting and linting enforced

- [x] **Project compiles**
  - `cargo build --workspace` succeeds
  - All crates properly configured

- [x] **MinIO running locally**
  - Accessible at http://localhost:9000
  - Test bucket created
  - Can upload/download test files

- [x] **README complete**
  - Vision and goals clear
  - Quick start instructions work
  - Architecture overview present

---

## Next Steps

After completing Initiative 1.1, move to:

**Initiative 1.2: Segment Format Design** - Implement the core data structure for storing events in S3 with compression and indexing.

---

## Time Estimate

**Total: 1 week** (assuming 20-30 hours of work)

- Repository setup: 1-2 hours
- Workspace configuration: 2-3 hours
- CI/CD pipeline: 2-3 hours
- MinIO setup: 1-2 hours
- Documentation: 3-4 hours
- Testing and debugging: 2-4 hours

---

## Success Criteria

âœ… Can run `cargo build --workspace` successfully
âœ… Can run `cargo test --workspace` successfully
âœ… CI passes on GitHub Actions
âœ… MinIO accessible and operational
âœ… README provides clear project overview
âœ… All team members (or you) can set up dev environment in < 30 minutes
