# StreamHouse Helm Chart Values
# Default configuration for development/testing
# Override these values for production deployments

# Global settings
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# ============================================================================
# Agent Configuration
# ============================================================================
agent:
  replicaCount: 3

  image:
    repository: streamhouse/agent
    tag: ""  # Defaults to Chart.appVersion
    pullPolicy: IfNotPresent

  # Resource limits
  resources:
    requests:
      memory: "2Gi"
      cpu: "1000m"
    limits:
      memory: "4Gi"
      cpu: "2000m"

  # Agent-specific configuration
  config:
    # gRPC server port
    grpcPort: 9090
    # HTTP metrics/health port
    httpPort: 8080
    # Agent group for routing
    agentGroup: "default"
    # Log level: debug, info, warn, error
    logLevel: "info"

  # S3/Object Storage configuration
  storage:
    # S3 bucket name
    bucket: "streamhouse-data"
    # AWS region (for AWS S3)
    region: "us-east-1"
    # Custom endpoint (for MinIO, LocalStack, etc.)
    endpoint: ""
    # Use path-style addressing (required for MinIO)
    pathStyle: false

  # Write-Ahead Log configuration
  wal:
    enabled: true
    # Sync policy: always, interval, never
    syncPolicy: "interval"
    # Sync interval in milliseconds (for interval policy)
    syncIntervalMs: 100

  # Throttling configuration
  throttle:
    enabled: true
    putRate: 3000
    getRate: 5000
    deleteRate: 3000

  # Persistent volume for WAL
  persistence:
    enabled: true
    size: 50Gi
    storageClass: ""
    accessMode: ReadWriteOnce

  # Pod scheduling
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}

  # Pod disruption budget
  pdb:
    enabled: true
    minAvailable: 2

  # Security context
  podSecurityContext:
    fsGroup: 1000
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    readOnlyRootFilesystem: false
    allowPrivilegeEscalation: false

  # Service configuration
  service:
    type: ClusterIP
    grpcPort: 9090
    httpPort: 8080
    annotations: {}

  # Autoscaling (optional)
  autoscaling:
    enabled: false
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

# ============================================================================
# Schema Registry Configuration
# ============================================================================
schemaRegistry:
  enabled: true
  replicaCount: 2

  image:
    repository: streamhouse/schema-registry
    tag: ""
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"

  config:
    port: 8081
    # Default compatibility level: BACKWARD, FORWARD, FULL, NONE
    compatibilityLevel: "BACKWARD"
    logLevel: "info"

  service:
    type: ClusterIP
    port: 8081

  # Authentication (optional)
  auth:
    enabled: false
    username: ""
    password: ""

  # Pod scheduling
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}

  # Pod disruption budget
  pdb:
    enabled: true
    minAvailable: 1

  # Security context
  podSecurityContext:
    fsGroup: 1000
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false

# ============================================================================
# Web UI Configuration
# ============================================================================
ui:
  enabled: true
  replicaCount: 2

  image:
    repository: streamhouse/ui
    tag: ""
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "250m"

  config:
    port: 3000

  service:
    type: ClusterIP
    port: 80

  # Pod scheduling
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}

  # Security context
  podSecurityContext:
    fsGroup: 1000
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    readOnlyRootFilesystem: false
    allowPrivilegeEscalation: false

# ============================================================================
# Ingress Configuration (unified for all services)
# ============================================================================
ingress:
  enabled: false
  className: ""
  annotations: {}
  # Example hosts configuration:
  # hosts:
  #   - host: streamhouse.example.com
  #     paths:
  #       - path: /api
  #         pathType: Prefix
  #         service: api
  #       - path: /schemas
  #         pathType: Prefix
  #         service: schema-registry
  #       - path: /
  #         pathType: Prefix
  #         service: ui
  hosts:
    - host: streamhouse.local
      paths:
        - path: /api
          pathType: Prefix
          service: api
        - path: /
          pathType: Prefix
          service: ui
  tls: []

# ============================================================================
# PostgreSQL Configuration (Bitnami dependency)
# ============================================================================
postgresql:
  enabled: true
  auth:
    username: streamhouse
    password: ""  # Set via --set or secrets
    database: streamhouse
  primary:
    persistence:
      enabled: true
      size: 10Gi
  # Use external PostgreSQL
  external:
    host: ""
    port: 5432
    username: ""
    password: ""
    database: ""

# ============================================================================
# MinIO Configuration (Bitnami dependency)
# ============================================================================
minio:
  enabled: true
  auth:
    rootUser: minioadmin
    rootPassword: ""  # Set via --set or secrets
  persistence:
    enabled: true
    size: 100Gi
  # Use external S3
  external:
    endpoint: ""
    accessKey: ""
    secretKey: ""
    bucket: ""

# ============================================================================
# Monitoring Configuration
# ============================================================================
monitoring:
  # Prometheus ServiceMonitor
  serviceMonitor:
    enabled: true
    interval: 15s
    scrapeTimeout: 10s
    labels: {}
    namespace: ""  # If empty, uses release namespace
    relabelings: []
    metricRelabelings: []

  # Grafana dashboards ConfigMap
  grafanaDashboards:
    enabled: true
    labels:
      grafana_dashboard: "1"

  # Prometheus rules (alerts)
  prometheusRules:
    enabled: true
    labels: {}

# ============================================================================
# Security Configuration
# ============================================================================
rbac:
  create: true

serviceAccount:
  create: true
  name: ""
  annotations: {}

networkPolicy:
  enabled: false
  ingress: []
  egress: []

# ============================================================================
# Common Configuration
# ============================================================================
nameOverride: ""
fullnameOverride: ""

# Additional labels for all resources
commonLabels: {}

# Additional annotations for all resources
commonAnnotations: {}
