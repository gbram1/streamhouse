apiVersion: v1
kind: Secret
metadata:
  name: {{ include "streamhouse.fullname" . }}-secrets
  labels:
    {{- include "streamhouse.labels" . | nindent 4 }}
type: Opaque
data:
  # S3/MinIO credentials
  {{- if .Values.minio.enabled }}
  S3_ACCESS_KEY: {{ .Values.minio.auth.rootUser | b64enc | quote }}
  S3_SECRET_KEY: {{ .Values.minio.auth.rootPassword | b64enc | quote }}
  {{- else if .Values.minio.external.accessKey }}
  S3_ACCESS_KEY: {{ .Values.minio.external.accessKey | b64enc | quote }}
  S3_SECRET_KEY: {{ .Values.minio.external.secretKey | b64enc | quote }}
  {{- else }}
  # Using IAM roles or instance profile for AWS S3 (no credentials needed)
  {{- end }}

  # PostgreSQL credentials
  {{- if .Values.postgresql.enabled }}
  POSTGRES_PASSWORD: {{ .Values.postgresql.auth.password | b64enc | quote }}
  DATABASE_URL: {{ include "streamhouse.postgresql.url" . | b64enc | quote }}
  {{- else }}
  POSTGRES_PASSWORD: {{ .Values.postgresql.external.password | b64enc | quote }}
  DATABASE_URL: {{ printf "postgres://%s:%s@%s:%d/%s" .Values.postgresql.external.username .Values.postgresql.external.password .Values.postgresql.external.host (.Values.postgresql.external.port | int) .Values.postgresql.external.database | b64enc | quote }}
  {{- end }}

  # Schema Registry credentials (if authentication enabled)
  {{- if .Values.schemaRegistry.auth.enabled }}
  SCHEMA_REGISTRY_USERNAME: {{ .Values.schemaRegistry.auth.username | b64enc | quote }}
  SCHEMA_REGISTRY_PASSWORD: {{ .Values.schemaRegistry.auth.password | b64enc | quote }}
  {{- end }}
