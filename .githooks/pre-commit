#!/bin/sh
# StreamHouse pre-commit hook
# Install: make hooks

set -e

echo "Running pre-commit checks..."

# Rust formatting
echo "  Checking Rust formatting..."
cargo fmt --all -- --check

# Rust linting (only on changed .rs files for speed)
CHANGED_RS=$(git diff --cached --name-only --diff-filter=ACM | grep '\.rs$' || true)
if [ -n "$CHANGED_RS" ]; then
    echo "  Running Clippy..."
    cargo clippy --workspace --all-features -- -D warnings
fi

# Web linting (only if web files changed)
CHANGED_WEB=$(git diff --cached --name-only --diff-filter=ACM | grep '^web/' || true)
if [ -n "$CHANGED_WEB" ]; then
    echo "  Linting web UI..."
    (cd web && npx eslint --quiet .) || true
fi

echo "Pre-commit checks passed."
