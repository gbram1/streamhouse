Metadata-Version: 2.4
Name: streamhouse
Version: 0.1.0
Summary: Python client for StreamHouse streaming data platform
Author: StreamHouse Team
License: Apache-2.0
Project-URL: Homepage, https://github.com/streamhouse/streamhouse
Project-URL: Documentation, https://docs.streamhouse.io
Project-URL: Repository, https://github.com/streamhouse/streamhouse
Project-URL: Issues, https://github.com/streamhouse/streamhouse/issues
Keywords: streamhouse,streaming,kafka,data,client
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: Apache Software License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Typing :: Typed
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Provides-Extra: sync
Requires-Dist: requests>=2.28.0; extra == "sync"
Provides-Extra: async
Requires-Dist: aiohttp>=3.8.0; extra == "async"
Provides-Extra: all
Requires-Dist: requests>=2.28.0; extra == "all"
Requires-Dist: aiohttp>=3.8.0; extra == "all"
Provides-Extra: dev
Requires-Dist: requests>=2.28.0; extra == "dev"
Requires-Dist: aiohttp>=3.8.0; extra == "dev"
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: ruff>=0.1.0; extra == "dev"

# StreamHouse Python Client

Python client for the StreamHouse streaming data platform.

## Installation

```bash
# Basic installation (no HTTP client included)
pip install streamhouse

# With sync support (requests)
pip install streamhouse[sync]

# With async support (aiohttp)
pip install streamhouse[async]

# With both sync and async support
pip install streamhouse[all]
```

## Quick Start

### Synchronous Usage

```python
from streamhouse import StreamHouseClient

# Create a client
client = StreamHouseClient("http://localhost:8080")

# Create a topic
topic = client.create_topic("events", partitions=3)
print(f"Created topic: {topic.name}")

# Produce messages
result = client.produce("events", value='{"event": "click", "user": "123"}')
print(f"Produced to partition {result.partition} at offset {result.offset}")

# Produce batch
results = client.produce_batch("events", [
    '{"event": "click"}',
    '{"event": "scroll"}',
    {"key": "user-123", "value": '{"event": "purchase"}'},
])
print(f"Produced {results.count} messages")

# Consume messages
result = client.consume("events", partition=0, offset=0, max_records=10)
for record in result.records:
    print(f"[{record.partition}:{record.offset}] {record.value}")

# Execute SQL query
result = client.query("SELECT * FROM events LIMIT 10")
for row in result.rows:
    print(row)

# List topics
topics = client.list_topics()
for t in topics:
    print(f"{t.name}: {t.partitions} partitions, {t.message_count} messages")
```

### Asynchronous Usage

```python
import asyncio
from streamhouse import StreamHouseClient

async def main():
    async with StreamHouseClient("http://localhost:8080") as client:
        # Create topic
        topic = await client.create_topic_async("events", partitions=3)

        # Produce message
        result = await client.produce_async("events", value='{"data": "test"}')

        # Consume messages
        result = await client.consume_async("events", partition=0)
        for record in result.records:
            print(record.value)

        # SQL query
        result = await client.query_async("SELECT COUNT(*) FROM events")
        print(result.rows)

asyncio.run(main())
```

### With Authentication

```python
from streamhouse import StreamHouseClient

client = StreamHouseClient(
    "http://localhost:8080",
    api_key="sk_live_your_api_key_here"
)

# All operations will use the API key
topics = client.list_topics()
```

## API Reference

### Topic Operations

| Method | Description |
|--------|-------------|
| `list_topics()` | List all topics |
| `create_topic(name, partitions, replication_factor=1)` | Create a new topic |
| `get_topic(name)` | Get topic details |
| `delete_topic(name)` | Delete a topic |
| `list_partitions(topic)` | List partitions for a topic |

### Producer Operations

| Method | Description |
|--------|-------------|
| `produce(topic, value, key=None, partition=None)` | Produce a single message |
| `produce_batch(topic, records)` | Produce multiple messages |

### Consumer Operations

| Method | Description |
|--------|-------------|
| `consume(topic, partition, offset=0, max_records=100)` | Consume messages |
| `list_consumer_groups()` | List all consumer groups |
| `get_consumer_group(group_id)` | Get consumer group details |
| `commit_offset(group_id, topic, partition, offset)` | Commit consumer offset |
| `delete_consumer_group(group_id)` | Delete a consumer group |

### SQL Operations

| Method | Description |
|--------|-------------|
| `query(sql, timeout_ms=None)` | Execute a SQL query |

### Cluster Operations

| Method | Description |
|--------|-------------|
| `list_agents()` | List all agents/servers |
| `get_metrics()` | Get cluster metrics |
| `health_check()` | Check server health |

All methods have async versions with `_async` suffix (e.g., `list_topics_async()`).

## Error Handling

```python
from streamhouse import (
    StreamHouseClient,
    NotFoundError,
    ValidationError,
    ConflictError,
    TimeoutError,
)

client = StreamHouseClient("http://localhost:8080")

try:
    topic = client.get_topic("nonexistent")
except NotFoundError as e:
    print(f"Topic not found: {e}")

try:
    client.create_topic("events", partitions=0)  # Invalid
except ValidationError as e:
    print(f"Validation error: {e}")

try:
    client.create_topic("events", partitions=3)
    client.create_topic("events", partitions=3)  # Already exists
except ConflictError as e:
    print(f"Topic already exists: {e}")
```

## Data Models

The client uses dataclasses for type-safe responses:

- `Topic` - Topic metadata
- `Partition` - Partition information
- `ProduceResult` - Result of producing a message
- `ConsumedRecord` - A consumed message
- `ConsumeResult` - Result of consuming messages
- `ConsumerGroup` - Consumer group summary
- `ConsumerGroupDetail` - Detailed consumer group info
- `Agent` - Server/agent information
- `SqlResult` - SQL query results

## Development

```bash
# Install dev dependencies
pip install -e ".[dev]"

# Run tests
pytest

# Type checking
mypy streamhouse

# Format code
black streamhouse
ruff check streamhouse
```

## License

Apache 2.0
